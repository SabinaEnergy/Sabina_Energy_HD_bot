<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
document.getElementById("form").addEventListener("submit", function(e) {
    e.preventDefault();

    const payload = {
        name: document.getElementById("name").value,
        gender: document.getElementById("gender").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        city: document.getElementById("city").value
    };

    if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
        // Открыто внутри Telegram
        Telegram.WebApp.sendData(JSON.stringify(payload));
        Telegram.WebApp.close();
    } else {
        // Открыто в браузере
        const params = new URLSearchParams(payload).toString();
        window.location.href = "{{ redirect_base }}" + "?" + params;
    }
});
</script>
